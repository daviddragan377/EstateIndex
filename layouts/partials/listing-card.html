{{- $country := .Params.country | default "" -}}
{{- $location := .Params.location | default "" -}}
{{- $priceNum := "0" -}}
{{- if .Params.price -}}
  {{- $priceNum = .Params.price | replaceRE "[^0-9]+" "" | default "0" -}}
{{- end -}}

<div class="group card overflow-hidden hover:shadow-lg transition-all duration-300" data-listing data-title="{{ .Title }}" data-country="{{ $country }}" data-location="{{ $location }}" data-type="{{ .Params.listingtype | default "" }}" data-bedrooms="{{ .Params.bedrooms | default "" }}" data-price="{{ $priceNum }}">
  <a href="{{ .Permalink }}" class="block h-full flex flex-col">
    <!-- Image Container -->
    {{ $hasImage := and .Params.images (gt (len .Params.images) 0) }}
    <div class="relative w-full h-56 overflow-hidden bg-gray-100">
      {{ if $hasImage }}
        {{ $img := index .Params.images 0 }}
        <img src="{{ $img }}" alt="{{ .Title }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" loading="lazy" />
      {{ else }}
        <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300">
          <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
        </div>
      {{ end }}
      
      <!-- Badge -->
      {{ if .Params.listingtype }}
        <span class="absolute top-3 left-3 bg-navy text-white text-xs font-semibold px-3 py-1.5 rounded-full">{{ .Params.listingtype }}</span>
      {{ end }}
      
      <!-- Image Count -->
      {{ if $hasImage }}
        <div class="absolute top-3 right-3 bg-navy bg-opacity-80 text-white text-xs font-semibold px-2.5 py-1.5 rounded-full flex items-center gap-1">
          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"></path></svg>
          {{ len .Params.images }}
        </div>
      {{ end }}
    </div>
    
    <!-- Content -->
    <div class="p-4 flex-1 flex flex-col">
      <!-- Title -->
      <h3 class="text-lg font-serif font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-navy transition-colors">
        {{ .Title }}
      </h3>
      
      <!-- Location Tags -->
      <div class="flex flex-wrap gap-2 mb-4">
        {{ if $country }}
          <span class="badge badge-primary text-xs">{{ $country }}</span>
        {{ end }}
        {{ if $location }}
          <span class="badge badge-secondary text-xs">{{ $location }}</span>
        {{ end }}
      </div>
      
      <!-- Details Summary -->
      <div class="space-y-2 mb-4">
        <!-- Price -->
        <div class="flex items-baseline gap-2">
          <p class="text-xl md:text-2xl font-serif font-bold text-navy">
            {{ .Params.price | default "Contact" }}
          </p>
        </div>
        
        <!-- Key Features -->
        {{ if or .Params.bedrooms .Params.bathrooms .Params.area }}
        <div class="text-sm text-gray-600 space-y-1">
          {{ if .Params.bedrooms }}
            <div>ğŸ›ï¸ {{ .Params.bedrooms }} Bedrooms</div>
          {{ end }}
          {{ if .Params.bathrooms }}
            <div>ğŸš¿ {{ .Params.bathrooms }} Bathrooms</div>
          {{ end }}
          {{ if .Params.area }}
            <div>ğŸ“ {{ .Params.area }}</div>
          {{ end }}
        </div>
        {{ end }}
      </div>
      
      <!-- CTA Footer -->
      <div class="mt-auto pt-4 border-t border-gray-100">
        <div class="flex items-center justify-between text-navy font-semibold group-hover:text-beige transition-colors text-sm">
          <span>View Details</span>
          <span class="group-hover:translate-x-1 transition-transform">â†’</span>
        </div>
      </div>
    </div>
  </a>
</div>

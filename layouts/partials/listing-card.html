<div class="group opacity-0 animate-fade-in card" data-listing data-title="{{ .Title }}" data-country="{{ .Params.country }}">
  <a href="{{ .Permalink }}" class="block h-full">
    <!-- Image -->
    {{ $hasImage := and .Params.images (gt (len .Params.images) 0) }}
    <div class="relative w-full h-48 rounded-lg mb-4 overflow-hidden group-hover:shadow-md transition-shadow {{ if not $hasImage }}bg-gradient-to-br from-gray-200 to-gray-300{{ end }}">
      {{ if $hasImage }}
        {{ $img := index .Params.images 0 }}
        <img src="{{ $img }}" alt="{{ .Title }}" class="absolute inset-0 w-full h-full object-cover" loading="lazy" />
      {{ else }}
        <div class="absolute inset-0 flex items-center justify-center">
          <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
        </div>
      {{ end }}
    </div>
    
    <!-- Content -->
    <div>
      <h3 class="text-lg font-serif font-bold text-gray-900 mb-2 line-clamp-2">
        {{ .Title }}
      </h3>
      
      <!-- Meta -->
      <div class="flex flex-wrap gap-2 mb-4">
        {{ if .Params.country }}
          <span class="badge badge-primary">
            {{ .Params.country }}
          </span>
        {{ end }}
        {{ if .Params.location }}
          <span class="badge badge-secondary">
            {{ .Params.location }}
          </span>
        {{ end }}
      </div>
      
      <!-- Price -->
      <p class="text-xl font-serif font-bold text-navy mb-2">
        {{ .Params.price | default "Contact" }}
      </p>
      
      <!-- Description -->
      {{ if .Params.bedrooms }}
      <p class="text-sm text-gray-600 mb-3">
        {{ .Params.bedrooms }} bed
        {{ if .Params.bathrooms }}• {{ .Params.bathrooms }} bath{{ end }}
        {{ if .Params.area }}• {{ .Params.area }}{{ end }}
      </p>
      {{ end }}
      
      <!-- CTA -->
      <div class="flex items-center space-x-2 text-navy font-semibold group-hover:space-x-3 transition-all">
        <span>View Details</span>
        <span>→</span>
      </div>
    </div>
  </a>
  
  <!-- Add to Comparison Button -->
  <button class="mt-4 w-full btn-secondary"
    onclick="addToComparison('{{ .Params.id }}', event)">
    + Add to Comparison
  </button>
</div>

<style>
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeIn 0.6s ease-out forwards;
}

.text-navy { color: #25304a; }
.badge { display: inline-block; padding: 0.25rem 0.5rem; font-size: 0.75rem; font-weight: 600; border-radius: 0.375rem; }
.badge-primary { background-color: rgba(37, 48, 74, 0.1); color: #25304a; }
.badge-secondary { background-color: #f3f4f6; color: #374151; }
</style>

<script>
function addToComparison(propertyId, event) {
  event.preventDefault();
  const stored = localStorage.getItem('comparison') || '[]';
  let items = JSON.parse(stored);
  
  if (!items.includes(propertyId)) {
    items = items.slice(-1);
    items.push(propertyId);
    localStorage.setItem('comparison', JSON.stringify(items));
    window.dispatchEvent(new Event('storage'));
    
    // Visual feedback
    const btn = event.target;
    const original = btn.textContent;
    btn.textContent = '✓ Added';
    btn.style.backgroundColor = '#10b981';
    btn.style.borderColor = '#10b981';
    btn.style.color = '#ffffff';
    setTimeout(() => {
      btn.textContent = original;
      btn.style.backgroundColor = '';
      btn.style.borderColor = '';
      btn.style.color = '';
    }, 2000);
  }
}
</script>
